# 二代测序的基本知识点，以及常见问题记录

## 1.知识点    

### 基因组相关知识：      
- 正链（+ strand / Watson strand / top strand）：通常指的是在参考基因组数据库中被选为“标准”或“正向”的那条链。它的序列是从5'到3'方向书写的。    
- 负链（- strand / Crick strand / bottom strand）：是与正链互补的那条链。它的序列是从5'到3'方向与正链反向平行的。    
- 基因组坐标是“物理位置”的标签，例如chr1:500-900 这个坐标区间，同时包含了正链上的500-900这段序列和负链上与之互补的500-900这段序列。它们是同一段双螺旋的两面。无论是说正链的 chr1:500-505 还是负链的 chr1:500-505，指的都是染色体1上第500到第505个碱基对这个物理区域。    
- 基因的方向：一个基因的启动子和编码区位于 chr1:500-900，如果它是正链基因，那么它的转录方向是从500向900移动；如果它是负链基因，那么它的转录方向是从900向500移动。但它们的物理位置都是 chr1:500-900。    
- 测序读段的比对：一个读段比对到 chr1:500-505 (+) 意味着它的序列与正链序列匹配；比对到 chr1:500-505 (-) 意味着它的序列与负链序列匹配（即与正链序列互补反向）。但它们都落在同一个物理坐标上。    
- 调控元件：一个增强子位于 chr1:500-900，它可以调控位于这个区域上游或下游的、任意方向的基因。     
- 因此，MACS2等peak calling软件的核心任务是在基因组的物理坐标上，识别出测序reads 5'端富集的区域，从而形成“峰”（peak）。这些peak本身代表的是无方向性的调控区域（如启动子、增强子等），其定义基于reads在正链和负链上5'端的对称性富集模式。      
- 当对peak进行基因注释时，方向性才被引入。注释过程会查询该peak物理位置附近或重叠的已知基因，而这些基因在基因组数据库（如GTF/GFF文件）中已有明确的转录方向（正链或负链）。因此，一个peak可能被注释为调控一个正链基因，也可能被注释为调控一个负链基因，这完全取决于被注释基因自身的转录方向。     

### 为什么参考基因组中 ​​通常没有 rRNA（核糖体 RNA）序列？​    
参考基因组主要包含的是该物种的“标准染色体 DNA 序列”（比如编码基因、非编码 DNA、调控区等），但它一般不单独包含“完整且重复的 rRNA 基因拷贝序列”，因为：​​​​    
1.​​ rRNA 基因是高度重复的序列（尤其是 18S、5.8S、28S 等）​​;​​    
​2. ​它们在基因组上存在几千个几乎相同的拷贝，属于“重复序列”（repetitive elements）​​;​​    
​​3. 参考基因组通常只保留一份（或代表性拷贝），而不是全部重复拷贝​​;​​    
​​4. 构建参考基因组时，优先选择“独特、非重复、具有功能代表性的序列”，而 rRNA 属于高度冗余的序列​​。​​    

### 参考基因组是怎么构建的？（简要流程）    
1. ​​DNA 提取与测序​​:从代表性个体（或群体）中提取高质量 DNA，进行 ​​高通量测序（如 Illumina、PacBio、Nanopore）​​     
2. ​​序列组装（Assembly）​​:利用计算算法（如 Falcon、Canu、MaSuRCA）将测序得到的短片段（reads）拼接成更长的 contigs / scaffolds, 最终尽量拼接成 ​​完整的染色体序列（如 1 号染色体、2 号染色体...）​​    
3. ​​注释（Annotation）​​:通过生物信息学工具（如 ​​Ensembl、GENCODE、NCBI​​）识别：    
- 哪些区域是 ​​基因（protein-coding / non-coding）​​​​    
- 哪些是 ​​启动子、增强子、UTR​​​​    
- 哪些是 ​​重复序列（如 transposons、rRNA、卫星 DNA）​​​​    
4. ​​选择代表性序列​​    
​​- 重复序列（如 rRNA、卫星 DNA、转座子）通常只保留一个或少量拷贝用于参考​​    
​​- 高度冗余且功能单一的序列（如 rRNA）不会全部纳入​​​​    
5. ​​发布参考基因组版本​​​​    
可在 ​​NCBI、UCSC、Ensembl​​ 等数据库下载​​    

### 二代测序中的公式     
|  项目   | 公式  | 
| :----: | :----: 
| 总测序碱基数/数据量（6G） | 参考基因组大小（3G） x  测序深度（2X，即平均每个碱基被测了2次） |     
| 片段数（20 M（20 million fragments）） | 总测序碱基数（6G）/ 每个片段测序长度（PE150 = 300 bp）|    

### 为什么要去接头    
一些短的 DNA 片段的读段，其 3' 端可能包含部分 Illumina 测序接头序列，这种接头污染可能导致读段无法比对到参考基因组，所以要去除。    

### 为什么ATAC-seq等涉及随机打断的组学，需要做双端测序     
- 在 ATAC-seq 中，我们希望了解实验所生成的 DNA 片段的完整跨度。ATAC 实验产生的 DNA 片段，是由Tn5酶切的，其片段长度是随机的，通常比单个测序读段更长，因此一个读段只能定义片段的一端。如果采用单端测序，我们就不得不推测片段另一端的位置。而双端测序能够从片段的两端分别生成读段，从而精确确定 DNA 片段的完整跨度。
- 双端测序能有效识别出PCR 重复序列（PCR duplicates）。PCR 重复是实验过程中的技术假象，应在分析流程中予以去除。然而，用于去除 PCR 重复的计算程序（例如 Picard 的 MarkDuplicates）通常通过比较比对后读段的末端位置来识别重复。在单端测序中，只有一个末端位置可供比较，因此任何 5' 端位置相同的读段都会被判定为重复，这可能导致大量假阳性，从而错误地删除本应保留的有效读段。相比之下，双端测序明确了原始 DNA 片段的两个末端。只有当一个片段的两端位置与另一个片段的两端完全匹配时，才会被判定为重复，这种情况随机发生的概率要低得多。因此，双端测序能显著减少假阳性，更准确地识别真正的 PCR 重复。

### 如何做两个组学的联合分析：    
表观组（ATAC-seq、ChIP-seq、CUT&Tag） 与 转录组（RNA-seq）联合分析：    
- 1.联合分析是为了解析染色质开放区域（组蛋白，转录因子，RNA polymerase II 等）与基因表达的关联。利用组学技术分析启动子、增强子或其他调控元件是否处于开放状态。
- 2.基因表达水平的差异：结合RNA-seq，评估这些区域中基因在不同条件下的表达差异，明确染色质开放性与基因表达是否存在直接联系。
- 3.推测特定处理或调控因子的作用机制：识别调控靶基因，将表观组（ATAC-seq、ChIP-seq、CUT&Tag）中识别的结合位点，与下游DEG整合，推测转录因子可能直接调控的靶基因集合。
- 4.构建调控网络：明确上游调控因子如何调控下游基因表达。
- 5.筛选疾病相关转录因子及其靶基因。
- 6.假设ATAC-seq结果中，获得了TF-motif-peak-gene的关系时，需要使用ChIP-seq或CUT&Tag等验证手段补充证据链！

具体绘图：
- 1.韦恩图：即表观组中差异peak（或称DAR），与转录组中的DEG，取交集。（注：一个DEG可能对应多个差异peak，是正常的。）
- 2.四象限图：通常优先研究1，3象限，即染色质开放性增加且基因表达增加的基因，或染色质开放性减少且基因表达减少的基因。（注：一个DEG可能对应多个差异peak，是正常的。此外，基因数少，也是正常的，这时候考虑放宽阈值。有过往的研究，是仅做p value的筛选，或仅做log2FC的筛选的，只要后续实验验证成功，证据链是完整的。）
- 3.表观组检测到的peak靶基因热图：对转录组中，选择p value最小的Top100基因绘制热图，同时标记这些基因是否在表观组存在peak（T / F）。
- 4.对这些有交接的基因，做GO/KEGG富集分析（同时在这些通路中标注上调及下调的基因有多少个）。

### 软件选取横向对比    

|  比对软件   | 适用组学  |  特点 |
| :----: | :----: | :----: |
| `BWA`  | ChIP-seq、CUT&Tag、ATAC-seq | 适用于全基因组或全外显子测序的比对 |
| `Bowtie`  | ChIP-seq、CUT&Tag、ATAC-seq | 为较短的DNA序列（35bp）设计，快速比对 |
| `Bowtie2`  | ChIP-seq、CUT&Tag、ATAC-seq | 长序列（50-100bp），内存占用小，多线程 |
| `HISAT2`  | ChIP-seq、CUT&Tag、ATAC-seq、m6A-seq、RIP-seq | 支持RNA-seq、DNA-seq比对。有更高的敏感性，快速，支持剪切位点识别和转录组重构 |

|  peak calling 软件   | 适用组学  |  特点 |
| :----: | :----: | :----: |
| `MACS2/3`  | ChIP-seq、CUT&Tag、ATAC-seq | 可处理单端，双端，通过双峰模型提高结合位点的空间分辨率，去重，归一化，使得数据之间有可比性 |
| `SEACR`  | CUT&RUN、CUT&Tag | 专门为CUT&RUN、CUT&Tag而制作的peak calling软件。能够将内参或IgG的非特异性结合片段或PCR重复片段去除（待补充） |
| `exomepeak`  | m6A-seq、RIP-seq | 支持多个生物学重复，内部自动去除PCR重复和多重比对序列，peak鉴定基于外显子的连接位点，增强peak鉴定的准确性 |
| `exomepeak2`  | m6A-seq、RIP-seq| 考虑重复性和GC偏差矫正 |

|  差异peak分析软件  | 适用组学  |  重复性 |  特点 |
| :----: | :----: | :----: | :----: |
| `MAnorm`  | ChIP-seq、CUT&Tag、ATAC-seq | 无 | 使用共同峰建立标准化模型，通过经验贝叶斯方法来估计信号变化。 |
| `DiffBind`  | ChIP-seq、CUT&Tag、ATAC-seq  | 有 | 用不同统计模型计算（DESseq2，edgeR） |
| `exomepeak` | m6A-seq、RIP-seq | 有/无 |  Fisher精确检验 |
| `exomepeak2`  | m6A-seq、RIP-seq| 有/无 | 通过GLM方法进行差异分析，考虑重复性，使用DESeq2将IP和input视为成对样本来鉴定DMR |

|  motif分析软件   | 适用组学  |  特点 |
| :----: | :----: | :----: |
| `homer` | ChIP-seq、CUT&Tag、ATAC-seq、m6A-seq、RIP-seq | 使用ZOOPS评分和超几何分布来确定motif富集，可识别和分析转录因子结合位点的motif（findMotifsgenome.pl） |
| `MEME`  | ChIP-seq、CUT&Tag、ATAC-seq、m6A-seq、RIP-seq | 运用EM算法分析motif，FIMO扫描已知motif，Tomtom用于motif比较，CentriMo用于识别特定位置富集的motif |

## 2. 常见的疑问       
高通量测序的重复序列是什么，什么时候该去除，什么时候不该去除？        

什么是多重比对，什么是PCR重复？       

关于CUT&Tag，该用`SEACR`还是用`MACS2`，这里需要查文献      

未完待续。08/17/2025


